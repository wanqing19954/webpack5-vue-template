import webpack from 'webpack'

const { Compilation } = webpack

export default class FileMapPlugin {
	constructor() {}
	apply(compiler) {
		compiler.hooks.emit.tapAsync(FileMapPlugin.name, (compilation, callback) => {
			console.log('complation')
			compilation.chunks.forEach((chunk) => {
        console.log('chunk', chunk.name)
				chunk.getModules().forEach((module) => {
          // console.log('module', module)
					module.buildInfo &&
						module.buildInfo.fileDependencies &&
						module.buildInfo.fileDependencies.forEach((filepath) => {
							// we've learned a lot about the source structure now...
							// console.log('filePath', filepath)
						})
				})

				// Explore each asset filename generated by the chunk:
				chunk.files.forEach((filename) => {
					// Get the asset source for each file generated by the chunk:
					var source = compilation.assets[filename].source()

					// console.log('getSource', source)
				})
			})

			callback()
		})
	}
}
